<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Confused Deputy Protection | SCIF</title>
    <meta name="description" content="A secure smart contract language">
    <link rel="preload stylesheet" href="/SCIF/assets/style.25c7b1e8.css" as="style">
    <link rel="modulepreload" href="/SCIF/assets/app.dd2a2f01.js">
    <link rel="modulepreload" href="/SCIF/assets/SecurityMechanisms_confused-deputy.md.fe1926e3.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-93a960b4><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-93a960b4 data-v-0fa0e57d><div class="VPNavBar has-sidebar" data-v-0fa0e57d data-v-be450ad9><div class="container" data-v-be450ad9><div class="title" data-v-be450ad9><div class="VPNavBarTitle has-sidebar" data-v-be450ad9 data-v-6d2fb2d9><a class="title" href="/SCIF/" data-v-6d2fb2d9><!--[--><!--]--><!----><!--[-->SCIF<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-be450ad9><div class="curtain" data-v-be450ad9></div><div class="content-body" data-v-be450ad9><!--[--><!--]--><!----><!----><!----><div class="VPNavBarAppearance appearance" data-v-be450ad9 data-v-da3f667a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-da3f667a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-be450ad9 data-v-66bb1f24 data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-96001b6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-96001b6b><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-66bb1f24><div class="item appearance" data-v-66bb1f24><p class="label" data-v-66bb1f24>Appearance</p><div class="appearance-action" data-v-66bb1f24><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-66bb1f24 data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-be450ad9 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-93a960b4 data-v-2817d72e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2817d72e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2817d72e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2817d72e>Menu</span></button><a class="top-link" href="#" data-v-2817d72e>Return to top</a></div><aside class="VPSidebar" data-v-93a960b4 data-v-c79ccefa><div class="curtain" data-v-c79ccefa></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c79ccefa><span class="visually-hidden" id="sidebar-aria-label" data-v-c79ccefa> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h2 class="text" data-v-b05232f3>Introduction</h2><!--]--><!----></a><!----></div><div class="items" data-v-b05232f3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/Introduction/getting-started.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Getting Started</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/Introduction/layout-of-a-scif-source-file.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Layout of a SCIF source file</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/Introduction/scif-by-example.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>SCIF by Example</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h2 class="text" data-v-b05232f3>Language Basics</h2><!--]--><!----></a><!----></div><div class="items" data-v-b05232f3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/LanguageBasics/information-flow-control.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Information Flow Control</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/LanguageBasics/types.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Types</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/LanguageBasics/contracts.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Contracts</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/LanguageBasics/exceptions-and-failures.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Exceptions and Failures</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/LanguageBasics/expressions-and-statements.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Expressions and Statements</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/LanguageBasics/built-in-methods-and-variables.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Built-in Methods and Variables</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0 has-active" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h2 class="text" data-v-b05232f3>Security Mechanisms</h2><!--]--><!----></a><!----></div><div class="items" data-v-b05232f3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/SecurityMechanisms/label-model.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Label Model</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/SecurityMechanisms/delegation.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Trust Delegation Mechanisms</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/SecurityMechanisms/reentrancy.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Reentrancy Protection</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/SCIF/SecurityMechanisms/confused-deputy.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Confused Deputy Protection</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-93a960b4 data-v-0bd490fb><div class="VPDoc has-sidebar has-aside" data-v-0bd490fb data-v-c5936a1e><div class="container" data-v-c5936a1e><div class="aside" data-v-c5936a1e><div class="aside-curtain" data-v-c5936a1e></div><div class="aside-container" data-v-c5936a1e><div class="aside-content" data-v-c5936a1e><div class="VPDocAside" data-v-c5936a1e data-v-cdc66372><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-cdc66372 data-v-5dd9d5f6><div class="content" data-v-5dd9d5f6><div class="outline-marker" data-v-5dd9d5f6></div><div class="outline-title" data-v-5dd9d5f6>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-5dd9d5f6><span class="visually-hidden" id="doc-outline-aria-label" data-v-5dd9d5f6> Table of Contents for current page </span><ul class="root" data-v-5dd9d5f6 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cdc66372></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c5936a1e><div class="content-container" data-v-c5936a1e><!--[--><!--]--><main class="main" data-v-c5936a1e><div style="position:relative;" class="vp-doc _SCIF_SecurityMechanisms_confused-deputy" data-v-c5936a1e><div><h1 id="confused-deputy-protection" tabindex="-1">Confused Deputy Protection <a class="header-anchor" href="#confused-deputy-protection" aria-hidden="true">#</a></h1><p><em>The confused deputy attack</em> is a type of attack where a trusted principal (the confused deputy) is tricked into misusing its integrity by the attacker, and causing integrity failures as a result.</p><p><a href="https://rekt.news/polynetwork-rekt/" target="_blank" rel="noreferrer">The Poly Network Attack</a> is an example of the confused deputy attack. And it is the second biggest cryptocurrency hack ($611M stolen) to date. Poly Network provided a service in their contract <code>EthCrossChainManager</code> where users could ask the service to call other contracts for them. However, Poly Network didn&#39;t notice that <code>EthCrossChainManager</code> was actually calling other contracts on its own behalf, and the user tricked it to call another important contract: <code>EthCrossChainData</code>, which maintained high-integrity information and was supposed to be called only by highly trusted parties. Because <code>EthCrossChainData</code> trusted <code>EthCrossChainManager</code>, any user could manipulate data in <code>EthCrossChainData</code> by confusing <code>EthCrossChainManager</code>.</p><p>In the lens of information flow control, the confused deputy attack involves three parties: the attacker, the deputy, and the victim. The attacker is not trusted by the deputy nor the victim, and the deputy is trusted by the victim. The deputy opens some entry point that allows the attacker to call and ask the deputy to execute legitimate tasks on the attacker&#39;s behalf. If the attacker asks the deputy to call the victim, the victim should reject this call since the deputy is acting on the attacker&#39;s behalf and the victim doesn&#39;t trust the attacker. <em>The confused deputy attack happens when this call is accepted somehow</em>.</p><p>External calls in smart contracts are like remote procedure calls: the caller has limited information and control over the environment in which the callee runs, and vice versa. To get rid of confused deputy vulnerabilities, SCIF applied additional checking both statically and dynamically.</p><h2 id="type-confusion-prevention" tabindex="-1">Type confusion prevention <a class="header-anchor" href="#type-confusion-prevention" aria-hidden="true">#</a></h2><p>When compiling to Solidity, information flow labels are stripped off from the code. And because the way Solidity assigns identities to methods, two methods whose signatures only differ in labels will be assigned the same id. This leads to potential of confused deputy vulnerabilities. For example, <code>uint{this} g{this}(uint{this} value)</code> and <code>uint{any} g{this}(uint{this} value)</code> will be assigned the same id while they return values of different integrity level, resulting in potential information flow violation.</p><p>To get rid of method type confusion, SCIF embeds labels in method signatures in their names when compiling to Solidity. For example, the name of a method <code>uint{this} g{this}(uint{this} value)</code> will become <code>&quot;g&quot; + hash([&quot;this&quot;, &quot;this&quot;, &quot;this&quot;])</code>, when compiling to a Solidity function.</p><h2 id="run-time-system-for-confused-deputy-prevention" tabindex="-1">Run-time system for confused deputy prevention <a class="header-anchor" href="#run-time-system-for-confused-deputy-prevention" aria-hidden="true">#</a></h2><div class="language-scif"><button title="Copy Code" class="copy"></button><span class="lang">scif</span><pre><code><span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> f1</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;">sender </span><span style="color:#81A1C1;">-&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#D8DEE9FF;">final ContractTarget</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">sender</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> target</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">sender</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">target</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">g</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">value</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> f2</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;">any </span><span style="color:#81A1C1;">-&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#D8DEE9FF;">ContractTarget</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">any</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> target</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">any</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">endorse</span><span style="color:#ECEFF4;">([</span><span style="color:#D8DEE9FF;">target</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">],</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">any </span><span style="color:#81A1C1;">-&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">this</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">target</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">g</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">value</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> f3</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;">any </span><span style="color:#81A1C1;">-&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">any</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">constTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">g</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">value</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> f4</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;">any </span><span style="color:#81A1C1;">-&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">this</span><span style="color:#ECEFF4;">}()</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">constTarget</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">g</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">constValue</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> g</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">sender</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> in ContractTarget</span></span>
<span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> g</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> in ContractRealTarget1</span></span>
<span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">any</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> g</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> in ContractRealTarget2</span></span>
<span class="line"></span></code></pre></div><div class="language-scif"><button title="Copy Code" class="copy"></button><span class="lang">scif</span><pre><code><span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> f1</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;">sender </span><span style="color:#81A1C1;">-&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#D8DEE9FF;">final ContractTarget</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">sender</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> target</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">sender</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    assert sender </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> target</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    assert this </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> target</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">    assert target </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> this</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">target</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">g</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">value</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> g</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">any</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    checkHash</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    assert sender </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> this</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">in ContractTarget</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">this</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> g</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;">l </span><span style="color:#81A1C1;">-&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">this</span><span style="color:#ECEFF4;">}(</span><span style="color:#81A1C1;">uint</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;">any</span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> value</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    checkHash</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    assert sender </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> l</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // if sender =&gt; l, can we trust sender calls in the right pc</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="support-for-legacy-code" tabindex="-1">Support for legacy code <a class="header-anchor" href="#support-for-legacy-code" aria-hidden="true">#</a></h2><p>When a SCIF contract calls a method in a legacy contract, its signature will be filled conservatively, promising the lowest level security gurantees. Any entry-point will be treated as a method that requires no integrity level and autoendorse to this, respects no locks and returns low-level values.</p><p>When a legacy contract calls a method in a SCIF contract, it is expected that the method pointer points to the method whose legacy method name matches the hash of the method signature.</p><h3 id="scif-calls-legacy" tabindex="-1">SCIF calls legacy <a class="header-anchor" href="#scif-calls-legacy" aria-hidden="true">#</a></h3><h3 id="legacy-calls-scif" tabindex="-1">legacy calls SCIF <a class="header-anchor" href="#legacy-calls-scif" aria-hidden="true">#</a></h3></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-c5936a1e data-v-e033cd21><div class="edit-info" data-v-e033cd21><!----><div class="last-updated" data-v-e033cd21><p class="VPLastUpdated" data-v-e033cd21 data-v-355aa5ef>Last updated: <time datetime="2024-12-30T04:34:01.000Z" data-v-355aa5ef></time></p></div></div><div class="prev-next" data-v-e033cd21><div class="pager" data-v-e033cd21><a class="pager-link prev" href="/SCIF/SecurityMechanisms/reentrancy.html" data-v-e033cd21><span class="desc" data-v-e033cd21>Previous page</span><span class="title" data-v-e033cd21>Reentrancy Protection</span></a></div><div class="has-prev pager" data-v-e033cd21><!----></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"introduction_getting-started.md\":\"2532e351\",\"languagebasics_methods.md\":\"a84c5444\",\"languagebasics_built-in-methods-and-variables.md\":\"c2bb35d7\",\"introduction_scif-by-example.md\":\"af092793\",\"languagebasics_contracts.md\":\"4cf2f5d7\",\"languagebasics_exceptions-and-failures.md\":\"ba028baa\",\"languagebasics_expressions-and-statements.md\":\"42dc3fc0\",\"languagebasics_information-flow-control.md\":\"ec168e4d\",\"securitymechanisms_label-model.md\":\"33186222\",\"languagebasics_types.md\":\"0e112158\",\"securitymechanisms_confused-deputy.md\":\"fe1926e3\",\"securitymechanisms_delegation.md\":\"25aa744f\",\"introduction_layout-of-a-scif-source-file.md\":\"8bd34c65\",\"toc.md\":\"25433d7b\",\"index.md\":\"c5f7d817\",\"securitymechanisms_reentrancy.md\":\"29440061\"}")</script>
    <script type="module" async src="/SCIF/assets/app.dd2a2f01.js"></script>
    
  </body>
</html>